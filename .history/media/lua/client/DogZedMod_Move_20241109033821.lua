--[[██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                        				 Custom  PZ  Mod  Developer  for  Hire													  |
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                       	Portfolio:  https://steamcommunity.com/id/glytch3r/myworkshopfiles/							          |
|                       		                                    														 	  |
|                       	Discord:    Glytch3r#1337 / glytch3r															      |
|                       		                                    														 	  |
|                       	Support:    https://ko-fi.com/glytch3r														    	  |
|_______________________________________________________________________________________________________________________________-]]
--[[_____________________________________________________________________________________________________________________________
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████--]]



DogZedMod = DogZedMod or {}

function DogZedMod.isCrawler(zed)
	return zed:isCrawling()
end

function DogZedMod.setCrawler(zed)
    if not zed:isCrawling() then
		--zed:toggleCrawling()
		if not zed:isCrawling() then
			--zed:setFallOnFront(true)
			zed:knockDown(true)
		end
		zed:setCanWalk(false)
		if not zed:isCrawling() then
			zed:setVariable('bbecomecrawler', 'true')
			zed:setCanCrawlUnderVehicle(true)
		end
    end

	local fitNum = tonumber(DogZedMod.getOutfitCrawlType(zed))
	local crawlType = zed:getCrawlerType()
	if fitNum ~= crawlType and (fitNum == 1 or  fitNum == 2) then
		zed:setCrawlerType(fitNum)
	end
	DogZedMod.setAnimSpeed(zed, DogZedMod.getMinAnimSpeed())
end


--[[ function DogZedMod.setCrawler(zed)
	local int = 2
	if not  zed:isCrawling()then
		zed:knockDown(true)
		--zed:setCrawling(true)

		zed:setCanCrawlUnderVehicle(true)
		zed:setCanWalk(false)
		zed:toggleCrawling()
	end
	local cType = zed:getCrawlerType()
	if int and cType then
		if cType ~= int then
			zed:setCrawlerType(int)
		end
	end
end ]]


function DogZedMod.isWalkable(sq)
    if not sq then return false end
    if sq:isSolid() then return false end
    if sq:isSolidTrans() then return false end
    if sq:Is(IsoFlagType.water) then return false end
    --if not square:isNotBlocked(false) then return false end
    return true
end

function DogZedMod.stopWalking(targ)
	targ:getPathFindBehavior2():reset();
end



function DogZedMod.isStepped(zed)
	return zed:isBeingSteppedOn()
end





function DogZedMod.isShouldStand(zed)
	if not zed:isBeingSteppedOn() then
		if zed:isCanWalk() then return true end
		if zed:isFakeDead() then return true end
		if zed:isForceEatingAnimation() then return true end
		if zed:isOnFloor() then return true end
		if zed:isCrawling() then return true end
		if zed:isUseless() then return true end
		if zed:isSitAgainstWall() then return true end
	end
    return false
end

function DogZedMod.setStand(zed)
    if not zed:isCanWalk() then
        zed:setCanWalk(true)
    end
    if zed:isFakeDead() or zed:isCurrentState(FakeDeadZombieState.instance())  then
        zed:setFakeDead(false)
		zed:setForceFakeDead(false);
    end
    if zed:isForceEatingAnimation() then
        zed:setForceEatingAnimation(false)
    end
    if zed:isSitAgainstWall() then
        zed:setSitAgainstWall(false)
    end
    if zed:isCrawling() then
        zed:toggleCrawling()
		zed:setCrawler(false)
    end
	if zed:isOnFloor() then
		zed:knockDown(false)
		zed:changeState(ZombieGetUpState.instance())
	end
	if zed:isUseless() then
		zed:setUseless(false)
	end
	zed:setOnFloor(false);
end

function DogZedMod.getWalkType(zed)
	return tostring(zed:getVariableString("zombieWalkType"))
end

function DogZedMod.getWalkNum(zed)
	local walk = DogZedMod.getWalkType(zed)
	return tonumber(walk:match("%d+"))
end

function DogZedMod.isSprinter(zed)
	local walk = DogZedMod.getWalkType(zed)
	if walk then
		if tostring(walk:contains('sprint')) or luautils.stringStarts(walk, "sprint") then
			return true
		end
	end
	return false
end



--[[
min speed (sandbox option)
max speed (sandbox option)

 ]]
function DogZedMod.normalize(x, min, max)
    x = math.max(min, math.min(x, max))
    return ((x - min) / (max - min)) * 100
end
--[[
DogZedMod.normalize(panic, minAnimSpeed, maxAnimSpeed)
math.max(minAnimSpeed, math.min(maxAnimSpeed, res))



local second = PZCalendar.getInstance():get(Calendar.SECOND)
local res = second / 6
res = luautils.round(res, 3)

 ]]


function DogZedMod.setTurnSpeed(zed, int)
	if zed:getTurnDelta() ~= int  then
		zed:setTurnDelta(int)
	end
end
function DogZedMod.isMoving(zed)
	if not zed then return false end
	if not DogZedMod.isDogZed(zed) then return false end
	if zed:getVariableBoolean('bMoving') then
		return true
	end
end
--math.max(0, math.min(100, res))

function DogZedMod.turnAround(targ)
	local x = targ:getX()
	local y = targ:getY()
	local offsetX = targ:getForwardDirection():getX() * 2
	local offsetY = targ:getForwardDirection():getY() * 2
	targ:faceLocation(x - offsetX, y - offsetY)
end

function DogZedMod.checkWalkableSq()
	local pl = getPlayer()
	local plSq = pl:getSquare()
	local rmSqs = plSq:getRoom():getSquares()
	if not pl:isOutside() then
		for i=0, rmSqs:size()-1 do
			local rmSq = rmSqs:get(i)
			local tab = {
				rmSq:getN(),
				rmSq:getS(),
				rmSq:getE(),
				rmSq:getW(),
			}
			for _, testSq in ipairs(tab) do
				if testSq  then
					local isGood = false
					if DogZedMod.isWalkable(testSq) then
						isGood = true
					end
					DogZedMod.TempMarker(testSq, isGood)
				end
			end
		end
	end
end

--[[
function DogZedMod.isShouldChangeWalkNum(zed)
	local walkNum =  DogZedMod.getWalkNum(zed)
	local num =  DogZedMod.getDayTimeInt()
	return walkNum ~= num
end
 ]]
--[[
 function DogZedMod.setMovement(zed)
	local isChanged = false
	if DogZedMod.isDogZed(zed) then
		local walkNum = tostring(DogZedMod.getWalkNum(zed))
		local num = tostring(DogZedMod.getDayTimeInt())
		--tostring(DogZedMod.getWalkType(zed))
		if DogZedMod.isAggro(zed) then
			zed:setWalkType("sprint"..tostring(num))
			isChanged = true
		else
			isChanged = true
			zed:setWalkType(tostring(num))
		end
		if isChanged then
			if getCore():getDebug() then

				if dbgZed == zed then
					local walk = DogZedMod.getWalkType(dbgZed)
					dbgZed:addLineChatElement(tostring(walk))
					print(walk)
				end

			end
		end

	end
end
 ]]

--[[
function DogZedMod.moveHandler(zed)
	if DogZedMod.isDogZed(zed) then
		if DogZedMod.isShouldChangeWalkNum(zed) then
			DogZedMod.setMovement(zed)
		end
	end
end
Events.OnZombieUpdate.Remove(DogZedMod.moveHandler)
Events.OnZombieUpdate.Add(DogZedMod.moveHandler)
 ]]



--if zed:isBehaviourMoving() or zed:isCurrentState(WalkTowardState.instance()) or zed:isCurrentState(WalkTowardNetworkState.instance()) or zed:isCurrentState(PathFindState.instance()) then

--[[
function DogZedMod.setRandWalkType(zed)
    local randWalkType = ZombRand(1, 5)
    zed:setWalkType(tostring(randWalkType)) -- Sets the random walk type as a string
    --zed:DoZombieStats()
    return randWalkType -- Return the random walk type as a number
end ]]

--[[
function DogZedMod.setFakeDead(zed, bool)
	if bool == nil then bool = false end
	if bool then
		zed:knockDown(bool)
		zed:setFakeDead(bool);
		zed:setForceFakeDead(bool);
		zed:Hit(nil, getPlayer(), 0, bool, 0)
	else
		DogZedMod.setStand(zed)
	end
	zed:setShootable(not bool)
	zed:setCollidable(not bool)
end ]]
--[[

function DogZedMod.setSprinter(zed)
	if  DogZedMod.isDogZed(zed) then
		local sandOpt = getSandboxOptions()
		local zSpeed = sandOpt:getOptionByName("ZombieLore.Speed"):getValue()
		--zed:setWalkType("sprint"..tostring(DogZedMod.getWalkNum(zed)));
		local num = DogZedMod.getDayTimeInt()
		sandOpt:set("ZombieLore.Speed", 1)
		zed:setWalkType("sprint"..tostring(num))
		zed:makeInactive(true)
		zed:makeInactive(false)
		zed:DoZombieStats()
		sandOpt:set("ZombieLore.Speed", zSpeed)
	end
end

function DogZedMod.setWalk(zed)
	if  DogZedMod.isDogZed(zed) then
		local sandOpt = getSandboxOptions()
		local zSpeed = sandOpt:getOptionByName("ZombieLore.Speed"):getValue()
		local num = DogZedMod.getDayTimeInt()
		sandOpt:set("ZombieLore.Speed", 2)
		zed:setWalkType(tostring(num))
		zed:makeInactive(true)
		zed:makeInactive(false)
		zed:DoZombieStats()
		sandOpt:set("ZombieLore.Speed", zSpeed)
	end
end
 ]]
